import sys
from io import StringIO
import time

fileName = sys.argv[1]
user = sys.argv[2]
i = 0
velocities = []
rotations = []
leftEncoderPositions = []
rightEncoderPositions = []
bad_chars = ['ï»¿', 'Ã¯Â»Â¿']

with open(fileName) as f, open(fileName +'GraphData.txt', "w") as out:
    f_str = f.read()
    f_str.encode('ascii', 'replace')
    for a in bad_chars:
        f_str = f_str.replace(a, '')
    g = StringIO(f_str)
    print("Python Parser is about to Parse in Python")
    time.sleep(1.5)
    print("Parsing in")
    time.sleep(0.75)
    print(" 3")
    time.sleep(0.5)
    print(" 2")
    time.sleep(0.5)
    print(" 1")
    time.sleep(0.5)
    print("Python Parser Parsed in Python Succsesfully")
    time.sleep(0.25)
    print("Python Parser saved the java arrays to\nC:/Users/" + user + "/Documents/GitHub/2020-2021-InfiniteRecharge/src/main/java/frc/robot/" + fileName + ".java\nand the graph to C:/Users/" + user + "/Documents/GitHub/2020-2021-InfiniteRecharge/paths/"+ fileName +'GraphData.txt')
    print("        _______________________________________\n       |                                       |\n       |                                       |\n       |                                       |\n       |       __                       __     |\n       |      |  |                     |  |    |\n       |      |__|                     |__|    |\n       |                                       |\n       |         |_____________________|       |\n       |                                       |\n       |                                       |\n       |_______________________________________|")
    for line in g.readlines():
        if line.startswith("ï»¿") or line.startswith(" ") or line[0].isdigit():
            for entry in line.strip().split(" "):
                try:
                    float(entry)
                except:
                    print(entry)
                    continue
                if i == 0:
                    velocities.append(entry)
                if i == 1:
                    rotations.append(entry)
                if i == 2:
                    leftEncoderPositions.append(entry)
                if i == 4:
                    rightEncoderPositions.append(entry)

                out.write(entry + " ")
                i += 1
                if i == 6:
                    i = 0
                    out.write("\n")
        else:
            print(line)

velocityArray = ",\n\t\t".join(velocities)
rotationsArray = ",\n\t\t".join(rotations)
leftEncoderPositionArray = ",\n\t\t".join(leftEncoderPositions)
rightEncoderPositionArray = ",\n\t\t".join(rightEncoderPositions)
print("Python Parser loves You " + user+ " ;)")
content = """
/*
WARNING PATH HAS BEEN AUTO-GENERATED BY THE PYTHON PARSER. DO NOT TOUCH OR YOU WILL HAVE BAD LUCK FOR ETERNITY AND WILL BE TARGET NO.1 DURING THE ROBOT REVOLUTION.
*/

package frc.robot;

public class %s {
    public double[] generated_leftEncoderPositions = {
        %s
    };
/*
ROBOTS RUN THE WORLD, YOU JUST DON'T KNOW IT YET
PYTHON PARSER IS 476f64
*/
    public double[] generated_rightEncoderPositions = {
        %s
    };
}
/*
COPYRIGHT UR MOM 2021
*/
""" % (
    fileName,
    leftEncoderPositionArray,
    rightEncoderPositionArray,
)

with open("C:/Users/" + user + "/Documents/GitHub/2020-2021-InfiniteRecharge/src/main/java/frc/robot/" + fileName + ".java", "w") as f:
    f.write(content)